

[toc]



# ğŸŒ²è¿›ç¨‹é€šä¿¡å¼•è®º

## ğŸŒ´æ¦‚å¿µ

è¿›ç¨‹é€šä¿¡æ˜¯æŒ‡åœ¨è¿›ç¨‹é—´ä¼ è¾“æ•°æ®(äº¤æ¢ä¿¡æ¯)ã€‚--ç™¾åº¦ç™¾ç§‘

> äººä¸äººä¹‹é—´çš„é€šä¿¡æ˜¯ä»€ä¹ˆï¼Ÿäº¤æ¢ä¿¡æ¯ã€‚è¿›ç¨‹ä¹‹é—´çš„ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯æ•°æ®ï¼æ‰€ä»¥**è¿›ç¨‹é€šä¿¡å¯ä»¥ç†è§£ä¸ºè¿›ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®ã€‚**
>
> **IPC**(InterProcess Communicatio)æ˜¯è¿›ç¨‹é—´é€šä¿¡çš„ç®€ç§°ã€‚

è¿›ç¨‹é€šä¿¡è¦åšçš„äº‹å¯ä»¥ç†è§£ä¸ºè®©å¤šä¸ªè¿›ç¨‹çœ‹åˆ°åŒä¸€å—èµ„æºã€‚

## ğŸŒ´ç›®çš„

è¿›ç¨‹é€šä¿¡çš„ç›®çš„

- æ•°æ®ä¼ è¾“ï¼šä¸€ä¸ªè¿›ç¨‹å‘é€æ•°æ®ç»™å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œæ•°æ®é‡åœ¨ä¸€ä¸ªå­—èŠ‚åˆ°å‡ Må­—èŠ‚ä¹‹é—´
- å…±äº«æ•°æ®ï¼šå¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€å—èµ„æºï¼Œåšåˆ°è¿™ç‚¹éœ€è¦å†…æ ¸æä¾›åŒæ­¥å’Œäº’æ–¥æœºåˆ¶ã€‚
- é€šçŸ¥äº‹ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å‘å¦ä¸€ä¸ªè¿›ç¨‹å‘æ¶ˆæ¯ï¼Œæ¯”å¦‚ä¸€ä¸ªè¿›ç¨‹ç»“æŸæ—¶åº”è¯¥é€šçŸ¥å…¶çˆ¶è¿›ç¨‹
- è¿›ç¨‹æ§åˆ¶ï¼šä¸€ä¸ªè¿›ç¨‹å®Œå…¨æ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œå¦‚debugè¿›ç¨‹ã€‚

> è¿™äº›å¬èµ·æ¥éƒ½å¤ªæŠ½è±¡äº†ï¼Œè”ç³»å®é™…åœºæ™¯æ‰èƒ½ç†è§£ã€‚

## ğŸŒ´æœ¬è´¨

è¿›ç¨‹é€šä¿¡çš„æœ¬è´¨å°±æ˜¯**è®©å¤šä¸ªè¿›ç¨‹çœ‹åˆ°åŒä¸€å—èµ„æº**ã€‚

> è¿™å—èµ„æºå¸¸æŒ‡çš„æ˜¯å†…å­˜èµ„æºï¼Œåœ¨linuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç†è§£æˆæ–‡ä»¶èµ„æºã€‚
>
> è¿›ç¨‹é€šä¿¡çš„æ–¹å¼ä¹Ÿæ˜¯å›´ç»•ç€è¿™ä¸€å¥è¯å±•å¼€çš„ã€‚

## ğŸŒ´åˆ†ç±»

System Vå’ŒPOSIXæˆ‘ç†è§£ä¸ºä¸åŒçš„æ ‡å‡†ã€‚

![image-20220720154922782](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720154922782.png)

æˆ‘ä»¬ä¸»è¦äº†è§£åŒ¿åç®¡é“ã€å‘½åç®¡é“ã€å…±äº«å†…å­˜å’Œä¿¡å·é‡ï¼Œé€šä¿¡æ–¹å¼ä¸åŒï¼Œè‡ªç„¶é€šä¿¡ç­–ç•¥ä¹Ÿä¸åŒã€‚

> [System v å’Œ Posixä½œç”¨å’ŒåŒºåˆ«ï¼ˆè¿›ç¨‹é—´é€šä¿¡IPCï¼‰_å±±å†œçš„åšå®¢-CSDNåšå®¢_system v](https://blog.csdn.net/return_cc/article/details/78417642)
>
> System Væ˜¯Unixç³»ç»Ÿçš„æŸä¸ªç‰ˆæœ¬ã€‚Posixæ˜¯ç”±IEEEå’ŒISOå¼€å‘çš„ä¸€å¥—æ ‡å‡†ï¼Œä¸¤ä¸ªéƒ½å¯ä»¥è¯´æ˜¯ä¸€ç§ç³»ç»Ÿæ¥å£çš„åè®®ã€‚

# ğŸŒ²ç®¡é“

## ğŸŒ´ç®¡é“æ¦‚å¿µ

ç®¡é“æ˜¯ä¸€ç§å¸¸è§çš„è¿›ç¨‹é€šä¿¡å·¥å…·ã€‚

Linuxé‡Œçš„ç®¡é“å‘½ä»¤æ˜¯'|'ã€‚

```shell
ls -l | grep *.txt
```

![image-20220720162349474](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720162349474.png)![image-20220720164405847](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720164405847.png)

## ğŸŒ´ä¸ºä»€ä¹ˆéœ€è¦ç®¡é“

æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ç®¡é“ï¼Œæˆ–è€…è¯´ä¸¤ä¸ªè¿›ç¨‹é—´èƒ½ç›´æ¥ä¼ é€’æ•°æ®å—ï¼Ÿå› ä¸ºè¿›ç¨‹é—´ä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œè¿›ç¨‹æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œå¦‚æœä¸¤ä¸ªè¿›ç¨‹ç›´æ¥ä¼ é€’æ•°æ®ï¼Œä¼šå‘ç”Ÿå†™æ—¶æ‹·è´ã€‚æ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåª’ä»‹ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œè®²çš„ç®¡é“ã€‚å€ŸåŠ©ç®¡é“æˆ‘ä»¬å¯ä»¥å®ç°ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„å•å‘é€šä¿¡ã€‚

> æ‰€ä»¥ç®¡é“çš„ä½œç”¨è‡ªç„¶ä¹Ÿå°±å‡ºæ¥äº†ï¼Œç®¡é“çš„ä½œç”¨å°±æ˜¯è®©ä¸¤ä¸ªè¿›ç¨‹çœ‹åˆ°åŒä¸€ä»½èµ„æº,è¿™ä¸ªèµ„æºå¸¸å¸¸æŒ‡çš„æ˜¯å†…å­˜èµ„æºï¼Œä¹Ÿå¯æŠ½è±¡ä¸ºæ–‡ä»¶èµ„æºã€‚

![image-20220720161823499](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720161823499.png)

![image-20220720161833247](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720161833247.png)

## ğŸŒ´åŒ¿åç®¡é“

åŒ¿åç®¡é“ç”¨äºæœ‰äº²å­å…³ç³»çš„è¿›ç¨‹ï¼Œå¸¸è§äºçˆ¶å­ä¹Ÿå¯ä»¥ç”¨äºå…„å¼Ÿç­‰ã€‚

![image-20220720170746651](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720170746651.png)

- ç®¡é“å®ç°å½¢æ€ä¸Šæ˜¯æ–‡ä»¶ï¼Œä½†æ˜¯ç®¡é“æœ¬èº«ä¸å ç”¨ç£ç›˜æˆ–å…¶ä»–å¤–éƒ¨å­˜å‚¨çš„ç©ºé—´--æ‘˜è‡ªçŸ¥ä¹ã€‚

- ç®¡é“æ–‡ä»¶çš„å†…å®¹åœ¨å†…å­˜çš„ç¼“å†²åŒºä¸Šï¼Œç¼“å†²åŒºçš„å†…å®¹ä¸ä¼šåˆ·æ–°åˆ°ç£ç›˜çš„æ–‡ä»¶ä¸Š

  > ä¸ªäººè®¤ä¸ºæ˜¯æ²¡å¿…è¦åˆ·æ–°åˆ°ç£ç›˜ä¸Šï¼Œä»å†…å­˜è¯»å–çš„é€Ÿåº¦æ¯”ä»ä»ç£ç›˜ä¸Šå¿«çš„å¤šï¼Œç®¡é“ä¼ è¾“æ•°æ®ä¹Ÿæ˜¯å•å‘çš„ï¼Œæ•°æ®è¢«æ¥æ”¶çš„è¿›ç¨‹è¯»å–åæ²¡å¿…è¦åˆ·æ–°åˆ°ç£ç›˜ä¸Šã€‚ç¡¬è¦åˆ·æ–°åˆ°ç£ç›˜ä¸Šçš„è¯é‚£æ²¡å¿…è¦ç”¨ç®¡é“...è®©è¿™ä¸¤ä¸ªè¿›ç¨‹åŠ è½½ç£ç›˜ä¸Šçš„åŒä¸€ä¸ªæ–‡ä»¶ä¸å°±è¡Œäº†ã€‚
  >
  > [å¤§ä½¬å¯¹äºç®¡é“çš„ä¸€äº›ç†è§£](http://bbs.chinaunix.net/thread-314244-1-1.html)ï¼Œä»ä¸­æ‘˜å½•ä¸€æ®µè¯ï¼šä½œä¸ºç®¡é“ï¼Œä¸€æ—¦åˆ›å»ºæˆåŠŸï¼Œåº”ç”¨é™¤äº†ä¼ é€’æ•°æ®å¤–ï¼Œèƒ½å¤Ÿåšçš„åªæœ‰åˆ é™¤æ“ä½œäº†ã€‚

### ğŸ¥åˆ›å»ºåŒ¿åç®¡é“

åŒ¿åç®¡é“ç”¨äºä¸¤ä¸ªæœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹‹é—´çš„å•å‘é€šä¿¡ï¼Œæ¯”å¦‚çˆ¶è¿›ç¨‹å†™å­è¿›ç¨‹è¯»ã€‚å¦‚æœæœ‰å¤šä¸ªè¿›ç¨‹éœ€è¦é€šä¿¡ï¼Œé‚£å°±å»ºç«‹å¤šä¸ªç®¡é“ã€‚

#### ğŸ¥pipeå‡½æ•°

 int pipe(int pipefd[2]);

ä¼ å…¥å‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿæ˜¯è¾“å‡ºå‹å‚æ•°ï¼Œpipefd[0]æ”¾ç®¡é“çš„è¯»ç«¯æ–‡ä»¶æè¿°ç¬¦ï¼Œpipefd[1]æ”¾ç®¡é“çš„å†™ç«¯æ–‡ä»¶æè¿°ç¬¦

![image-20220720161833247](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720220833958.png)

pipeå‡½æ•°çš„ä½œç”¨

![image-20220720224446834](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720224446834.png)

> è¿™é‡Œçš„ç®­å¤´è¡¨ç¤ºæŒ‡é’ˆæŒ‡å‘ï¼Œè€Œä¸æ˜¯æ•°æ®æµå‘

pipeç»“åˆforkä¹‹åçš„å›¾

![image-20220720225237600](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720225237600.png)

**çˆ¶å­è¿›ç¨‹é€šè¿‡å…³é—­æ–‡ä»¶æè¿°ç¬¦æ¥å®ç°ç®¡é“çš„å•å‘é€šä¿¡**

å¯¹ç®¡é“é‡Œé¢å†™å…¥æ•°æ®çš„æ“ä½œï¼Œå’Œå¯¹æ–‡ä»¶é‡Œå†™å…¥æ•°æ®çš„æ“ä½œä¸€æ ·ï¼Œå°è¯äº†Linuxä¸‹çš„ä¸€åˆ‡çš†æ–‡ä»¶ã€‚

ç®¡é“æ˜¯å•å‘çš„ï¼Œè‚¯å®šæ˜¯ä¸€ä¸ªå†™ä¸€ä¸ªè¯»ã€‚æ‰€ä»¥å»ºè®®å†™ä¹‹å‰å…³é—­è¯»ï¼Œè¯»ä¹‹å‰å…³é—­å†™

> æ—¢ç„¶æ˜¯å†™ä¹‹å‰è¦å…³é—­è¯»ï¼Œè¯»ä¹‹å‰è¦å…³é—­å†™ï¼Œé‚£ä¸€å¼€å§‹ä¸ºä»€ä¹ˆè¿˜è¦æ‰“å¼€è¯»å†™å‘¢ï¼Œåªæ‰“å¼€è¯»æˆ–è€…åªæ‰“å¼€å†™ä¸å°±è¡Œäº†å—ã€‚å› ä¸ºçˆ¶å­è¿›ç¨‹æ‹¿åˆ°çš„æ–‡ä»¶æ‰“å¼€æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœçˆ¶è¿›ç¨‹åªæ‰“å¼€è¯»é‚£å­è¿›ç¨‹ä¹Ÿåªèƒ½è¯»ï¼Œä¹Ÿå°±ä¸èƒ½å†™äº†ï¼Œæˆ‘ä»¬æœ‰æåˆ°ç®¡é“è‚¯å®šæ˜¯ä¸€ä¸ªå†™ä¸€ä¸ªè¯»ï¼Œæ‰€ä»¥çˆ¶è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„æ–¹å¼è‚¯å®šæ˜¯è¯»å†™ï¼ˆrwï¼‰ã€‚
>
> ä¸ºä»€ä¹ˆå»ºè®®è¯»ä¹‹å‰å…³é—­å†™ï¼Œå†™ä¹‹å‰å…³é—­è¯»ï¼Ÿé˜²æ­¢è¯¯æ“ä½œã€‚

ä¸‹é¢çš„ä»£ç ï¼šçˆ¶è¿›ç¨‹åˆ›å»ºç®¡é“ï¼Œçˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹åœ¨ç®¡é“é‡Œæ¯éš”1så†™å…¥ä¸€æ¬¡æ•°æ®ï¼Œçˆ¶è¿›ç¨‹å»è¯»ã€‚

```c
#include <stdio.h>
#include<unistd.h>
#include<string.h>
#include <stdlib.h>
#include<sys/types.h>
#include <sys/wait.h>
int main()
{
  int pipe_fd[2]={0};
  int ret=pipe(pipe_fd);
  if(ret<0)
  {
    perror("pipe");
    return 1;
  }
  pid_t id=fork();
  if(id==0)
  {
    //child write
    close(pipe_fd[0]);//å†™ä¹‹å‰å…³é—­è¯»
    int cnt=5;
    const char* msg="hello world!\n";
    while(cnt--)
    {
      write(pipe_fd[1],msg,strlen(msg));
      sleep(1);
    }
    close(pipe_fd[1]);
    exit(0);
  }
  else if(id>0)
  {
    //father read 
    close(pipe_fd[1]);//è¯»ä¹‹å‰å…³é—­å†™
    char buffer[128];
    while(1)
    {
      ssize_t num=read(pipe_fd[0],buffer,127);//è¯»åˆ°å‡ ä¸ªå­—èŠ‚
      if(num>0)
      {
        buffer[num]='\0';
        printf("father get the msg from child:%s\n",buffer);
      }
      else if(num==0) 
      {
        printf("piple file close,child quit\n");
        break;
      }
      else 
      {
        perror("read");
      }
    }
    close(pipe_fd[0]);
    int status=0;
    if(waitpid(id,&status,0)>0)
    {
      printf("wait success!\n");
    }
  }
  else 
  {
    perror("fork");
  }
  return 0;
}
```

è¿è¡Œæ•ˆæœ

![image-20220720232449493](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720232449493.png)

> éšç¬”è®°å½•ï¼šåƒµå°¸è¿›ç¨‹çš„äº§ç”Ÿæ˜¯å› ä¸ºçˆ¶è¿›ç¨‹æ²¡æœ‰ wait () å­è¿›ç¨‹ã€‚,æ‰€ä»¥å¦‚æœæˆ‘ä»¬è‡ªå·±å†™ç¨‹åºçš„è¯ä¸€å®šè¦åœ¨çˆ¶è¿›ç¨‹ä¸­é€šè¿‡ wait () æ¥é¿å…åƒµå°¸è¿›ç¨‹çš„äº§ç”Ÿï¼Œåƒµå°¸è¿›ç¨‹çš„äº§ç”Ÿä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚å­è¿›ç¨‹åƒµå°¸ï¼Œçˆ¶è¿›ç¨‹æ²¡å›æ”¶ï¼Œçˆ¶è¿›ç¨‹é€€å‡ºååƒµå°¸å­è¿›ç¨‹ä¼šäº¤ç»™Initè¿›ç¨‹ï¼ŒInitè¿›ç¨‹ä¼šå‘ç°å¹¶å›æ”¶è¿™ä¸ªåƒµå°¸è¿›ç¨‹ï¼Œå¦‚æœçˆ¶è¿›ç¨‹ä¸€ç›´åœ¨è¿è¡Œï¼Œå­è¿›ç¨‹ä¸€ç›´åƒµå°¸ï¼Œå†…å­˜å°±æ³„æ¼äº†ã€‚

### ğŸŒµç®¡é“è¯»å†™çš„å››ç§ç‰¹æ®Šæƒ…å†µ

1. å†™ç«¯è¿›ç¨‹ä¸€ç›´å†™ï¼Œè¯»ç«¯è¿›ç¨‹ä¸è¯»ã€‚å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æœªè¢«å…³é—­

å¦‚æœç®¡é“æ»¡äº†ï¼Œå°±è¦ç­‰ç®¡é“æœ‰ç©ºé—²ç©ºé—´æ‰èƒ½ç»§ç»­å†™ï¼Œä¹Ÿå°±æ˜¯è¢«è¯»ç«¯è¿›ç¨‹è¯»èµ°åæ‰èƒ½ç»§ç»­å†™ã€‚ç®€å•æ¥è¯´å°±æ˜¯**writeé˜»å¡**

```c
#include <stdio.h>
#include<unistd.h>
#include<string.h>
#include <stdlib.h>
#include<sys/types.h>
#include <sys/wait.h>
int main()
{
  int pipe_fd[2]={0};
  int ret=pipe(pipe_fd);
  if(ret<0)
  {
    perror("pipe");
    return 1;
  }
  pid_t id=fork();
  if(id==0)
  {
   //  child write
    close(pipe_fd[0]);
      
    const char* msg="hello world!\n";
    int cnt=1;
    while(cnt)//å†™ç«¯è¿›ç¨‹ä¸æ–­å†™
    {
      write(pipe_fd[1],msg,strlen(msg));
      printf("child writes the msg:%d\n",cnt);
      cnt++;
    }
      
    close(pipe_fd[1]);
    exit(0);
  }
  else if(id>0)
  {
     // father read 
    close(pipe_fd[1]);
      
    int status=0;
    if(waitpid(id,&status,0)>0)
    {
      printf("wait success!\n");
    }
  }
  else 
  {
    perror("fork");
  }
    
  return 0;
}
```

![image-20220721093754149](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721093754149.png)

2. å†™ç«¯è¿›ç¨‹ä¸å†™ï¼Œè¯»ç«¯è¿›ç¨‹ä¸€ç›´è¯»ã€‚å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æœªè¢«å…³é—­

è¯»ç«¯è¿›ç¨‹ä¸€ç›´è¯»ï¼Œå› ä¸ºç®¡é“é‡Œæ²¡æœ‰æ•°æ®ï¼Œè¯»ç«¯è¿›ç¨‹å°±è¢«æŒ‚èµ·äº†ï¼Œç®€å•æ¥è¯´å°±æ˜¯readé˜»å¡ã€‚

```c
#include <stdio.h>
#include<unistd.h>
#include<string.h>
#include <stdlib.h>
#include<sys/types.h>
#include <sys/wait.h>
int main()
{
  int pipe_fd[2]={0};
  int ret=pipe(pipe_fd);
  if(ret<0)
  {
    perror("pipe");
    return 1;
  }
  pid_t id=fork();
  if(id==0)
  {
   //  child write
    close(pipe_fd[0]);
    while(1)//å­è¿›ç¨‹ä¸å†™æ•°æ®
    {
      printf("pipe is NULL\n");
      sleep(1);
    }
    exit(0);
  }
  else if(id>0)
  {
     // father read 
    close(pipe_fd[1]);
     char buffer[128];
     while(1) //çˆ¶è¿›ç¨‹ä¸€ç›´åœ¨è¯»
     { 
        ssize_t num=read(pipe_fd[0],buffer,127);
        if(num>0)
        {
          buffer[num]='\0';
          printf("father get the msg from child:%s\n",buffer);
        }
        else if(num==0) 
        {
          printf("piple file close,child quit\n");
          break;
        }
        else 
        {
          perror("read");
        }
     } 
     close(pipe_fd[0]);
    int status=0;
    if(waitpid(id,&status,0)>0)
    {
      printf("wait success!\n");
    }
  }
  else 
  {
    perror("fork");
  }

  return 0;
}

```

> éšç¬”è®°å½•ï¼šgdbæ¨¡å¼ä¸‹set listsize n,ä¿®æ”¹listé»˜è®¤æ˜¾ç¤ºçš„ä»£ç è¡Œæ•°

![image-20220721100749537](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721100749537.png)

3. å†™ç«¯è¿›ç¨‹å†™å®Œåè¢«å…³é—­ï¼Œè¯»ç«¯è¿›ç¨‹è¿˜åœ¨è¯»ã€‚

ä¸ä¼šå‡ºç°writeå’Œreadé˜»å¡çš„é—®é¢˜ï¼Œè€Œæ˜¯è¯»ç«¯å‘ç°å†™ç«¯å…³é—­åreadç›´æ¥è¿”å›0ï¼Œç„¶åç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ã€‚

```c
#include <stdio.h>
#include<unistd.h>
#include<string.h>
#include <stdlib.h>
#include<sys/types.h>
#include <sys/wait.h>
int main()
{
  int pipe_fd[2]={0};
  int ret=pipe(pipe_fd);
  if(ret<0)
  {
    perror("pipe");
    return 1;
  }
  pid_t id=fork();
  if(id==0)
  {
   //  child write
    close(pipe_fd[0]);
    
    int cnt=5;
    const char* msg="hello world!\n";
    while(cnt--)
    {
      write(pipe_fd[1],msg,strlen(msg));
      printf("child writes the msg:%d\n",cnt);
      sleep(1);
    }
    close(pipe_fd[1]);
    cnt=3;
    while(cnt--)
    {
      printf("pipe has closed\n");
      sleep(1);
    }
    exit(0);
  }
  else if(id>0)
  {
     // father read 
    close(pipe_fd[1]);
     char buffer[128];
     while(1) { 
        ssize_t num=read(pipe_fd[0],buffer,127);
        if(num>0)
        {
          
          buffer[num]='\0';
          printf("father get the msg from child:%s\n",buffer);
        }
        else if(num==0) 
        {
          printf("piple file close,child quit\n");
          break;
        }
        else 
        {
          perror("read");
        }
     } 
     close(pipe_fd[0]);
    int status=0;
    if(waitpid(id,&status,0)>0)
    {
      printf("wait success!\n");
    }
  }
  else 
  {
    perror("fork");
  }

  return 0;
}

```

![image-20220721101704562](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721101704562.png)

4. å†™ç«¯è¿›ç¨‹ä¸€ç›´å†™ï¼Œè¯»ç«¯è¿›ç¨‹è¢«å…³é—­ã€‚

å†™çš„ç›®çš„ä¸å°±æ˜¯è¯»å—ï¼Œè¯»éƒ½è¢«å…³é—­äº†ï¼Œå†™è‡ªç„¶ä¹Ÿå°±æ²¡æœ‰æ„ä¹‰äº†ã€‚è€Œå†™ç«¯è¿˜åœ¨ä¸€ç›´å†™å…¥æ•°æ®ï¼Œç³»ç»Ÿä¼šå¹²æ‰å†™ç«¯è¿›ç¨‹ã€‚

```c
#include <stdio.h>
#include<unistd.h>
#include<string.h>
#include <stdlib.h>
#include<sys/types.h>
#include <sys/wait.h>
int main()
{
  int pipe_fd[2]={0};
  int ret=pipe(pipe_fd);
  if(ret<0)
  {
    perror("pipe");
    return 1;
  }
  pid_t id=fork();
  if(id==0)
  {
   //  child write
    close(pipe_fd[0]);
    
    int cnt=5;
    const char* msg="hello world!\n";
    while(cnt--)
    {
      write(pipe_fd[1],msg,strlen(msg));
      printf("child writes the msg:%d\n",cnt);
      sleep(1);
    }
    close(pipe_fd[1]);
    cnt=3;
    while(cnt--)
    {
      printf("pipe has closed\n");
      sleep(1);
    }
    exit(0);
  }
  else if(id>0)
  {
     // father read 
    close(pipe_fd[1]);
    close(pipe_fd[0]);
    int status=0;
    if(waitpid(id,&status,0)>0)
    {
      printf("wait success!\n");
    }
  }
  else 
  {
    perror("fork");
  }

  return 0;
}

```

![image-20220721102500499](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721102500499.png)

ç•¥å¾®ä¿®æ”¹ä»£ç ï¼Œæ‹¿åˆ°ç»ˆæ­¢å­è¿›ç¨‹çš„ä¿¡å·ã€‚

![image-20220721104514670](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721104514670.png)

### ğŸŒµç®¡é“è¯»å†™çš„ç‰¹ç‚¹

æ ¹æ®ä¸Šé¢å‡ ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥çª¥æ¢å‡ºç®¡é“çš„ä¸€äº›ç‰¹ç‚¹ã€‚

- ç®¡é“è‡ªå¸¦åŒæ­¥æœºåˆ¶

> å¯ä»¥å‘ç°ç®¡é“é‡Œæœ‰æ•°æ®æ‰ä¼šè¢«è¯»
>
> ç®¡é“é‡Œæ²¡æœ‰æ•°æ®è¯»ç«¯è¿›ç¨‹å°±ä¼šåœ¨é‚£ç­‰
>
> ç®¡é“å†™æ»¡äº†å°±ä¸ä¼šå†å†™ï¼Œå°±åœ¨é‚£ç­‰å¾…è¢«è¯»ï¼Œè¿™äº›éƒ½æ˜¯åŒæ­¥çš„ä½“ç°ï¼Œè¡¨ç°ä¸ºè¿›ç¨‹çš„è¿è¡Œæœ‰å…ˆåé¡ºåºã€‚
>
> ä¸ªäººç†è§£åŒæ­¥çš„è¿›ç¨‹è¿è¡Œèµ·æ¥å¦‚åŒæœ‰æ¡ä»¶çº¦æŸä¸€èˆ¬ï¼Œæ¯”å¦‚å½“ç®¡é“æœ‰æ•°æ®æ‰å»è¯»ï¼Œè¿™ç§æœºåˆ¶æœ‰ç‚¹â€œæŸæ‰‹æŸè„šâ€çš„æ„æ€ï¼Œè€Œä¸æ˜¯å„è¿è¡Œå„çš„ï¼Œä¸ä¼šå‘ç”Ÿç®¡ä½ æœ‰æ²¡æœ‰æ•°æ®æˆ‘éƒ½å»è¯»è¿™ç§æƒ…å†µã€‚åŒæ­¥æœºåˆ¶ä¸€èˆ¬ç”±åŠ é”å®ç°

- ç®¡é“æ˜¯å•å‘é€šä¿¡çš„ï¼Œè‚¯å®šæ˜¯ä¸€ä¸ªå†™ä¸€ä¸ªè¯»
- åŒ¿åç®¡é“åªèƒ½ä¿è¯æ˜¯å…·æœ‰è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼Œå¸¸å¸¸ç”¨äºçˆ¶å­ã€‚

> linuxä¸‹çš„ç®¡é“å‘½ä»¤â€˜|â€™æŒ‡çš„å°±æ˜¯åŒ¿åç®¡é“ï¼Œä»–ä»¬æœ‰åŒä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯bashè¿›ç¨‹ã€‚

- ç®¡é“æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼ˆç½‘ç»œé‚£å—ä¼šè¯¦ç»†é˜è¿°é¢å‘å­—èŠ‚æµï¼‰
- ç®¡é“å¯ä»¥ä¿è¯ä¸€å®šç¨‹åº¦çš„æ•°æ®è¯»å–çš„åŸå­æ€§ï¼ˆåŸå­æ€§ï¼šäº‹åŠ¡çš„ä¸å¯åˆ†å‰²æ€§ï¼Œä¸€ä¸ªæ“ä½œè¦ä¹ˆè¢«å…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼Œè¿™ä¸ªæ“ä½œä¹Ÿå°±æ˜¯åŸå­æ“ä½œï¼ŒåŸå­æ“ä½œä¸€èˆ¬é€šè¿‡åŒæ­¥æœºåˆ¶å®Œæˆï¼ŒéåŸå­æ“ä½œå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸€èˆ¬é€šè¿‡åŠ é”ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼‰
- **ç®¡é“çš„ç”Ÿå‘½å‘¨æœŸéšè¿›ç¨‹**ï¼Œç®¡é“ä¹Ÿæ˜¯æ–‡ä»¶ï¼Œè¿›ç¨‹é€€å‡ºç®¡é“è‡ªç„¶ä¹Ÿä¼šè¢«å…³é—­ã€‚

### ğŸŒµç®¡é“çš„å¤§å°

```shell
ulimit -a
```

0.5KB*8=4KB

![image-20220721104817801](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721104817801.png)

**å†™ç¨‹åºå¯ä»¥éªŒè¯ç®¡é“å®¹é‡å¤§å°æœ€å¤§æ˜¯65526ä¸ªå­—èŠ‚**(64KB)

ä»£ç å®ç°ä¸Šæ³¨æ„å†™æ»¡ç®¡é“å‰å­è¿›ç¨‹ä¸èƒ½é€€å‡ºäº†ï¼Œå­è¿›ç¨‹é€€å‡ºäº†çš„è¯è¡¨ç¤ºè¯»ç«¯æ²¡äº†ï¼Œå†™ç«¯ï¼ˆçˆ¶è¿›ç¨‹ï¼‰å°±ä¼šè¢«ç³»ç»Ÿå¹²æ‰ï¼Œ~~æˆ‘å½“æ—¶æ²¡æ³¨æ„åˆ°è¿™ç§æƒ…å†µæ‰“å°åˆ°äº”åƒå¤šå°±åœäº†ã€‚~~

```c
#include <stdio.h>
#include<string.h>
#include <stdlib.h>
#include<sys/types.h>
#include <sys/wait.h>
#include<unistd.h>
int main()
{
  int pipe_fd[2]={0};
  pipe(pipe_fd);
  pid_t id=fork();
  if(id==0)
  {
    close(pipe_fd[1]);
    while(1)//å­è¿›ç¨‹ä¸èƒ½æå‰é€€å‡º
    {
      sleep(1);
    }

    close(pipe_fd[0]);
  }
  else
  {   
    close(pipe_fd[0]);
    char c='a';
    int cnt=1;
    while(1)
    {
      write(pipe_fd[1],&c,1);
      printf("%d\n",cnt);
      cnt++;
    }
    close(pipe_fd[1]);
    waitpid(id,NULL,0);

  }
  return 0;
}
```

![image-20220721153501198](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721153501198.png)

ä¸ºä»€ä¹ˆulimits -aæ‰“å°çš„æ˜¯4KB,æˆ‘ä»¬æµ‹è¯•çš„æ—¶å€™æ˜¯64KBå‘¢ï¼Ÿ4KBæ˜¯æœ€å°å•å…ƒï¼Œæ¯”å¦‚æˆ‘å†™å…¥4097ä¸ªå­—èŠ‚ï¼Œé‚£ç³»ç»Ÿä¼šåˆ†é…8KBç»™æˆ‘ä»¬ï¼Œåªæ˜¯æˆ‘ä»¬åªèƒ½ç”¨4097ä¸ªå­—èŠ‚ã€‚

> å‚è€ƒèµ„æ–™ğŸ‘‰[Linuxç®¡é“çš„å®¹é‡å¤§å°åŠç®¡é“çš„æ•°æ®ç»“æ„](https://blog.csdn.net/jyy305/article/details/57122788)
>
> éšç¬”è®°å½•ï¼šå–æ¶ˆ43,70è¡Œçš„æ³¨é‡Š
>
> ![image-20220721111710687](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721111710687.png)
>
> :43,70 s/^/\/\//g å¯ä»¥æ³¨é‡Š43-70è¡Œ

## ğŸŒ´å‘½åç®¡é“

åŒ¿åç®¡é“åªèƒ½ç”¨äºä¸¤ä¸ªæœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é€šä¿¡ï¼Œå¦‚æœæ²¡æœ‰äº²ç¼˜å…³ç³»åˆè¦é€šä¿¡çš„è¯ï¼Œæ­¤æ—¶å°±éœ€è¦å‘½åç®¡é“äº†ã€‚

![image-20220721162609034](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721162609034.png)

### ğŸŒµåˆ›å»ºå‘½åç®¡é“

**mkfifoå‘½ä»¤**

![image-20220721154338535](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721154338535.png)

#### ğŸ¥mkfifoå‡½æ•°

 int mkfifo(const char *pathname, mode_t mode);

> æ–‡ä»¶è·¯å¾„å…·æœ‰å”¯ä¸€æ€§ï¼Œæ‰€ä»¥å¯ä»¥è®©ä¸¤ä¸ªè¿›ç¨‹çœ‹åˆ°åŒä¸€ä»½èµ„æºã€‚

![image-20220721155720841](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721155720841.png)

åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç®¡é“æ–‡ä»¶çš„ä¾‹å­ã€‚

```c
#include<stdio.h>
#include<sys/types.h>
#include <sys/stat.h>

int main()
{
  if(mkfifo("./myfifo",0644)<0)
  {
    perror("mkfifo");
    return 1;
  }
  return 0;
}
```

è¿è¡Œæ•ˆæœ

![image-20220721160915504](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721160915504.png)

### ğŸŒµserverå’Œclientçš„å°demo

serverï¼ŒæœåŠ¡ç«¯è¯»ã€‚

clientï¼Œå®¢æˆ·ç«¯å†™ã€‚

åœ¨æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªç®¡é“æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯æ‰“å¼€æ–‡ä»¶åè¿›è¡Œå†™å…¥ï¼ŒæœåŠ¡ç«¯å†æ‰“å¼€æ–‡ä»¶è¯»å–æ•°æ®å°±å®ç°äº†æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤ä¸ªè¿›ç¨‹çš„é€šä¿¡ã€‚

å¯åŠ¨çš„æ—¶å€™æ˜¯å…ˆå¯åŠ¨æœåŠ¡ç«¯ï¼Œå› ä¸ºè¦åˆ›å»ºç®¡é“æ–‡ä»¶ã€‚

**server.c**

```c
#include <stdio.h>
#include<unistd.h>
#include <sys/types.h>
#include<sys/stat.h>
#include <fcntl.h>

int main()
{
  if(mkfifo("./myfifo",0644)<0)
  {
    perror("mkfifo");
    return 1;
  }
  int fd=open("myfifo",O_RDWR);
  if(fd<0)
  {
    perror("open");
    return 2;
  }
  while(1)
  {
    char buf[128];
    ssize_t num=read(fd,buf,sizeof(buf)-1);
    buf[num]='\0';
    printf("server has got the msg:%s\n",buf);
    sleep(1);
  }
  return 0;
}
```

client.c

```c
#include <stdio.h>
#include<unistd.h>
#include <sys/types.h>
#include<sys/stat.h>
#include <fcntl.h>
#include <string.h>

int main()
{
  int fd=open("myfifo",O_RDWR);
  if(fd<0)
  {
    perror("open");
    return 1;
  }
  while(1)
  {
    const char* msg="hello world\n";
    write(fd,msg, strlen(msg));
    printf("client has wrote the msg!\n\n");
    sleep(1);
  }
  return 0;

}
```

**Makefile**

```makefile
.PHONY:all
all:client server 

client:client.c
	gcc -o $@ $^

server:server.c
	gcc -o $@ $^

.PHONY:clean
clean:
	rm -f client server
```

è¿è¡Œæ•ˆæœ

![image-20220721171251655](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220721171251655.png)

> å‘½åç®¡é“è¿˜æœ‰å¾ˆå¤šç”¨é€”ã€‚æ¯”å¦‚è¿›ç¨‹é¥æ§ï¼Œè¿˜å¯ä»¥ç»“åˆè¿›ç¨‹æ›¿æ¢ä¼ é€’å‘½ä»¤ï¼Œç­‰ç­‰ã€‚

## ğŸŒ´åŒ¿åç®¡é“å’Œå‘½åç®¡é“çš„åŒºåˆ«

- åŒ¿åç®¡é“ç”¨äºæœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼Œå‘½åç®¡é“ç”¨äºä»»æ„ä¸¤ä¸ªè¿›ç¨‹ã€‚
- åŒ¿åç®¡é“çš„æ‰“å¼€äº¤ç»™äº†pipeå‡½æ•°ï¼Œpipeå‡½æ•°ä¼šåˆ›å»ºå¹¶æ‰“å¼€ã€‚å‘½åç®¡é“çš„åˆ›å»ºäº¤ç»™äº†mkfifoå‡½æ•°ï¼Œç®¡é“çš„æ‰“å¼€äº¤ç»™äº†openã€‚
- ä¸¤è€…å”¯ä¸€åŒºåˆ«å°±æ˜¯æ‰“å¼€å’Œåˆ›å»ºæ–¹å¼ä¸åŒï¼Œåˆ›å»ºå’Œæ‰“å¼€å®Œæˆåï¼Œä¸¤è€…å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ã€‚ï¼ˆå› ä¸ºåˆ›å»ºå’Œæ‰“å¼€çš„å·¥ä½œå°±æ˜¯è®©ä¸¤ä¸ªè¿›ç¨‹çœ‹åˆ°ä¸€å—èµ„æºï¼Œæ€ä¹ˆæ“ä½œèµ„æºå°±æ˜¯æ–‡ä»¶æ“ä½œçš„äº‹äº†ï¼‰

# ğŸŒ²System V IPC

æˆ‘çš„ç†è§£System Vå°±æ˜¯ä¸€ä¸ªæ ‡å‡†,è¿™ä¸ªæ ‡å‡†ä¸‹æœ‰å‡ ç§é€šä¿¡æ–¹å¼ã€‚

## å…±äº«å†…å­˜



## ä¿¡å·é‡















![image-20220719151054909](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719151054909.png)

![image-20220719152016120](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719152016120.png)



![image-20220719153042214](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719153042214.png)

shm share memoryå…±äº«å†…å­˜

![image-20220719153243922](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719153243922.png)



![image-20220719153622384](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719153622384.png)

![image-20220719154801571](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719154801571.png)

![image-20220719155220924](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719155220924.png)



![image-20220719155355755](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719155355755.png)

![image-20220719155814181](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719155814181.png)





![image-20220719155912371](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719155912371.png)



![image-20220719160830688](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719160830688.png)

![image-20220719161326855](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719161326855.png)



![image-20220719161623436](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719161623436.png)

![image-20220719161718563](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719161718563.png)



![image-20220719162316112](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719162316112.png)







![image-20220719162425953](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719162425953.png)





![image-20220719162554471](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719162554471.png)

![image-20220719162924649](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719162924649.png)

![image-20220719162939495](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719162939495.png)

![image-20220719163037580](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719163037580.png)

![image-20220719171304725](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719171304725.png)

![image-20220719171603106](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719171603106.png)

![image-20220719171811732](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719171811732.png)

![image-20220719235658639](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220719235658639.png)

![ ](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720000122172.png)

![image-20220720004215949](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720004215949.png)

![image-20220720004958182](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720004958182.png)

![image-20220720005232499](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720005232499.png)

![image-20220720005417419](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720005417419.png)





![image-20220720005559630](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720005559630.png)



![image-20220720005725504](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720005725504.png)







![image-20220720011752922](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720011752922.png)



![image-20220720011933017](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720011933017.png)



![image-20220720093052910](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720093052910.png)









![image-20220720095806242](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720095806242.png)



![image-20220720100109236](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720100109236.png)









![image-20220720100754883](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720100754883.png)



![image-20220720101535473](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720101535473.png)



![image-20220720101854875](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720101854875.png)

![image-20220720102558449](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720102558449.png)



![image-20220720103117877](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720103117877.png)

![image-20220720103906920](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220720103906920.png)

