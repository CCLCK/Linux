

![image-20220729100757005](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729100757005.png)



![image-20220729103143204](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729103143204.png)

CPU眼里线程是0感知的  看到的都是task_struct

![image-20220729103219065](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729103219065.png)

轻量化：上下文数据不用变了  比起之前的执行 换一个进程 数据，页表和地址空间，甚至缓存数据等等都要换 但是切换线程时这些都不用动

用进程来模拟的

![image-20220729113527762](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729113527762.png)



之前说CPU进行的是进程调度，到现在加一层理解，CPU调度的其实都是线程

![image-20220729113829018](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729113829018.png)



![image-20220729125800585](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729125800585.png)





![image-20220729130325143](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729130325143.png)

![image-20220729130313212](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729130313212.png)

合适：与计算机核数相当

不合适：线程过多 CPU过多的时间花在切换线程上（同步和调度开销



![image-20220729150250511](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729150250511.png)

![image-20220729153722753](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729153722753.png)



#### ![image-20220729150804824](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729150804824.png)



![image-20220729151309339](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729151309339.png)

![image-20220729151321121](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729151321121.png)





![image-20220729151740976](C:/Users/ADMIN/AppData/Roaming/Typora/typora-user-images/image-20220729151740976.png)

![](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729151825406.png)





以前是单执行流 两个相等

![image-20220729152106991](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729152106991.png)





![image-20220729152556070](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729152556070.png)

一个线程出问题导致进程退出 这也是为什么说线程降低了程序的健壮性

![image-20220729153537161](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729153537161.png)



![image-20220729154050200](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729154050200.png)



![image-20220729155046825](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729155046825.png)



![image-20220729154750471](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729154750471.png)



![image-20220729155021524](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729155021524.png)

![image-20220729155622247](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729155622247.png)



![image-20220729161349626](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729161349626.png)



![image-20220729160803246](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729160803246.png)

![image-20220729161623417](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729161623417.png)



其他进程干掉主进程 其他线程一直跑导致进程一直处于Z状态 不被回收 

![image-20220729163136584](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729163136584.png)



![image-20220729163236006](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729163236006.png)



CPU不需要线程的概念   linux下线程这个概念是给用户的  因为用户需要多线程编程

因为不管进程还是线程啊 在linux内核里都是task_struct



linux下进程模拟实现的线程。



线程优点和缺点 斗与共享大量资源有关

进程为什么独立  因为有自己独立的地址空间 页表等。





![image-20220729212914901](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729212914901.png)



防止内存泄漏  （一直占着资源没释放，有点Z状态的意思

让main线程最后退出（main没了还有别的线程在跑不太合理

获得新线程的退出码（任务做的怎么样

  

![image-20220729213353372](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220729213353372.png)

 















































































































